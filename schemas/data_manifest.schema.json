{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://reason2return.local/schemas/data_manifest.v1.schema.json",
  "title": "Data Manifest v1",
  "description": "Metadata for a dataset snapshot ensuring reproducibility",
  "type": "object",
  "required": ["manifest_version", "created_at", "data_sources", "hash"],
  "properties": {
    "manifest_version": {
      "type": "string",
      "description": "Manifest schema version",
      "const": "1.0"
    },
    "created_at": {
      "type": "string",
      "format": "date-time",
      "description": "Manifest creation timestamp"
    },
    "description": {
      "type": "string",
      "description": "Human-readable description of this dataset"
    },
    "data_sources": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["source_type", "source_id", "date_range", "record_count"],
        "properties": {
          "source_type": {
            "type": "string",
            "enum": [
              "prices",
              "fundamentals",
              "news",
              "sentiment",
              "insider",
              "macro",
              "synthetic"
            ],
            "description": "Type of data source"
          },
          "source_id": {
            "type": "string",
            "description": "Unique identifier for this source"
          },
          "date_range": {
            "type": "object",
            "required": ["start", "end"],
            "properties": {
              "start": { "type": "string", "format": "date" },
              "end": { "type": "string", "format": "date" }
            }
          },
          "record_count": {
            "type": "integer",
            "minimum": 0,
            "description": "Number of records from this source"
          },
          "tickers": {
            "type": "array",
            "items": { "type": "string" },
            "description": "List of tickers covered (optional)"
          },
          "file_path": {
            "type": "string",
            "description": "Relative path to data file"
          },
          "file_hash": {
            "type": "string",
            "description": "SHA-256 hash of data file"
          }
        }
      }
    },
    "features": {
      "type": "object",
      "description": "Feature engineering metadata",
      "properties": {
        "feature_list": {
          "type": "array",
          "items": { "type": "string" },
          "description": "List of feature names"
        },
        "lookback_days": {
          "type": "integer",
          "minimum": 1,
          "description": "Lookback window for feature calculation"
        },
        "vol_lookback": {
          "type": "integer",
          "minimum": 1,
          "description": "Volatility calculation lookback"
        }
      }
    },
    "labels": {
      "type": "object",
      "description": "Label generation metadata",
      "properties": {
        "horizons": {
          "type": "array",
          "items": { "type": "integer", "minimum": 1 },
          "description": "Forward return horizons in days"
        },
        "label_scheme": {
          "type": "string",
          "enum": ["volatility_normalized", "raw_returns", "custom"],
          "description": "Labeling methodology"
        },
        "num_classes": {
          "type": "integer",
          "minimum": 2,
          "description": "Number of classification labels"
        }
      }
    },
    "hash": {
      "type": "string",
      "description": "SHA-256 hash of entire dataset for versioning",
      "pattern": "^[a-f0-9]{64}$"
    },
    "git_commit": {
      "type": "string",
      "description": "Git commit SHA of code used to generate this data",
      "pattern": "^[a-f0-9]{40}$"
    }
  }
}
